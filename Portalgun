-- Client-side and server-side combined script

-- Create RemoteEvent if not exists
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local requestCashDropEvent = ReplicatedStorage:FindFirstChild("RequestCashDrop")

if not requestCashDropEvent then
    requestCashDropEvent = Instance.new("RemoteEvent")
    requestCashDropEvent.Name = "RequestCashDrop"
    requestCashDropEvent.Parent = ReplicatedStorage
end

-- Function to find a player by partial name
local function findPlayerByPartialName(partialName)
    local matchingPlayers = {}
    
    for _, player in ipairs(game.Players:GetPlayers()) do
        if string.lower(player.Name):sub(1, #partialName):lower() == partialName:lower() then
            table.insert(matchingPlayers, player)
        end
    end
    
    if #matchingPlayers > 0 then
        return matchingPlayers[1] -- Return the first match
    else
        return nil
    end
end

-- Function to handle cash drop request
local function handleCashDrop(targetPlayer)
    if targetPlayer then
        print("Player found: " .. targetPlayer.Name)
        local args = {
            [1] = "DropMoney",
            [2] = "10000"
        }
        -- Use the RemoteEvent to simulate server-side action
        requestCashDropEvent:FireServer(targetPlayer.UserId)
    else
        print("No player found for cash drop.")
    end
end

-- Set up RemoteEvent listener for server-side processing
requestCashDropEvent.OnServerEvent:Connect(function(player, targetUserId)
    local targetPlayer = game.Players:GetPlayerByUserId(targetUserId)
    if targetPlayer then
        local args = {
            [1] = "DropMoney",
            [2] = "10000"
        }
        -- Ensure MainEvent exists for executing action
        local mainEvent = ReplicatedStorage:FindFirstChild("MainEvent")
        if mainEvent then
            mainEvent:FireServer(unpack(args))
        else
            print("MainEvent not found in ReplicatedStorage.")
        end
    else
        print("Target player not found.")
    end
end)

-- GUI setup
local function setupGUI()
    local player = game.Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = playerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 200)
    frame.Position = UDim2.new(0, 50, 0, 50)
    frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    frame.BorderSizePixel = 2
    frame.Parent = screenGui

    -- Drag functionality
    local dragging = false
    local dragInput, dragStart, startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if dragging then
                update(input)
            end
        end
    end)
    
    -- Input field for player name
    local playerNameBox = Instance.new("TextBox")
    playerNameBox.Size = UDim2.new(0, 250, 0, 50)
    playerNameBox.Position = UDim2.new(0, 25, 0, 25)
    playerNameBox.PlaceholderText = "Enter Player Name"
    playerNameBox.Parent = frame
    
    -- Drop Cash button
    local dropButton = Instance.new("TextButton")
    dropButton.Size = UDim2.new(0, 250, 0, 50)
    dropButton.Position = UDim2.new(0, 25, 0, 100)
    dropButton.Text = "Drop Cash"
    dropButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    dropButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropButton.Parent = frame
    
    -- Button click event
    dropButton.MouseButton1Click:Connect(function()
        local playerName = playerNameBox.Text
        if playerName == "" then return end
        
        local targetPlayer = findPlayerByPartialName(playerName)
        
        if targetPlayer then
            print("Player found: " .. targetPlayer.Name)
            -- Simulate the request to drop cash
            requestCashDropEvent:FireServer(targetPlayer.UserId)
        else
            print("No player found with the name: " .. playerName)
        end
    end)
end

-- Execute the GUI setup
setupGUI()
