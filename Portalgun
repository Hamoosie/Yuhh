-- Client-side script to be executed in a LocalScript

-- Setup for GUI and RemoteEvent
local function setup()
    local player = game.Players.LocalPlayer
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = player:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 200)
    frame.Position = UDim2.new(0, 50, 0, 50)
    frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    frame.BorderSizePixel = 2
    frame.Parent = screenGui

    -- Drag functionality
    local dragging = false
    local dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if dragging then
                update(input)
            end
        end
    end)

    -- Input field for player name
    local playerNameBox = Instance.new("TextBox")
    playerNameBox.Size = UDim2.new(0, 250, 0, 50)
    playerNameBox.Position = UDim2.new(0, 25, 0, 25)
    playerNameBox.PlaceholderText = "Enter Player Name"
    playerNameBox.Parent = frame

    -- Drop Cash button
    local dropButton = Instance.new("TextButton")
    dropButton.Size = UDim2.new(0, 250, 0, 50)
    dropButton.Position = UDim2.new(0, 25, 0, 100)
    dropButton.Text = "Drop Cash"
    dropButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    dropButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropButton.Parent = frame

    -- Function to find the player by partial name
    local function findPlayerByPartialName(partialName)
        local matchingPlayers = {}
        
        for _, otherPlayer in ipairs(game.Players:GetPlayers()) do
            if string.lower(otherPlayer.Name):sub(1, #partialName):lower() == partialName:lower() then
                table.insert(matchingPlayers, otherPlayer)
            end
        end
        
        if #matchingPlayers > 0 then
            return matchingPlayers[1]  -- Return the first match
        else
            return nil
        end
    end

    -- Button click event
    dropButton.MouseButton1Click:Connect(function()
        local playerName = playerNameBox.Text
        if playerName == "" then return end

        local targetPlayer = findPlayerByPartialName(playerName)

        if targetPlayer then
            print("Player found: " .. targetPlayer.Name)

            -- Send request to the server to execute cash drop for the target player
            local requestCashDropEvent = game.ReplicatedStorage:FindFirstChild("RequestCashDrop")
            if requestCashDropEvent then
                requestCashDropEvent:FireServer(targetPlayer.UserId)
            else
                print("RemoteEvent 'RequestCashDrop' not found.")
            end
        else
            print("No player found with the name: " .. playerName)
        end
    end)
end

-- Execute the setup
setup()
