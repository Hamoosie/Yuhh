-- Services
local Players = game:GetService("Players")

-- Print message indicating the script has been executed
print("Script has been executed successfully.")

-- Function to teleport the local player to another player
local function teleportToPlayer(targetPlayer)
    local localPlayer = Players.LocalPlayer
    if localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") and
       targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        localPlayer.Character:SetPrimaryPartCFrame(targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)) -- Slightly above the target to avoid collision
        print("Teleported to " .. targetPlayer.Name)
    else
        print("Teleportation failed: Local player or target player character is missing.")
    end
end

-- Function to handle chat messages
local function onChatMessage(player, message)
    print("Received message from " .. player.Name .. ": " .. message) -- Debug: Show received chat message

    -- Check if the message starts with ".teleport "
    if message and message:sub(1, 10) == ".teleport " then
        local username = message:sub(11)
        if username and username ~= "" then
            print("Searching for player with username starting with: " .. username) -- Debug: Show username being searched

            -- Find the player by username or partial username
            local targetPlayer = nil
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Name:lower():sub(1, #username) == username:lower() then
                    targetPlayer = p
                    break
                end
            end
            
            if targetPlayer then
                -- Ensure the teleportation happens with consideration of network latency and game restrictions
                local success, err = pcall(function()
                    teleportToPlayer(targetPlayer)
                end)
                if not success then
                    print("Failed to teleport: " .. err)
                end
            else
                print("No player found with username starting with: " .. username)
            end
        else
            print("Username is empty.")
        end
    end
end

-- Function to connect chat message handler to players
local function detectChatMessages()
    -- Listen for when a player joins the game
    Players.PlayerAdded:Connect(function(player)
        -- Listen for chat messages from the player
        player.Chatted:Connect(function(message)
            onChatMessage(player, message)
        end)
    end)

    -- Connect to already existing players
    for _, player in ipairs(Players:GetPlayers()) do
        player.Chatted:Connect(function(message)
            onChatMessage(player, message)
        end)
    end
end

-- Start detecting chat messages
detectChatMessages()

print("Chat message detection setup complete.")
