-- Setup for UI elements
local player = game.Players.LocalPlayer
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
local menuFrame = Instance.new("Frame", screenGui)
menuFrame.Size = UDim2.new(0, 200, 0, 300)
menuFrame.Position = UDim2.new(0, 0, 0.2, 0)  -- Moved down by 20% of the screen height
menuFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

local playerNameInput = Instance.new("TextBox", menuFrame)
playerNameInput.Size = UDim2.new(1, 0, 0, 50)
playerNameInput.Position = UDim2.new(0, 0, 0, 0)
playerNameInput.PlaceholderText = "Enter player name"
playerNameInput.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
playerNameInput.TextColor3 = Color3.fromRGB(0, 0, 0)

local teleportButton = Instance.new("TextButton", menuFrame)
teleportButton.Size = UDim2.new(1, 0, 0, 50)
teleportButton.Position = UDim2.new(0, 0, 0, 50)
teleportButton.Text = "Teleport"
teleportButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)

local knockButton = Instance.new("TextButton", menuFrame)
knockButton.Size = UDim2.new(1, 0, 0, 50)
knockButton.Position = UDim2.new(0, 0, 0, 100)
knockButton.Text = "Knock"
knockButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)

local viewButton = Instance.new("TextButton", menuFrame)
viewButton.Size = UDim2.new(1, 0, 0, 50)
viewButton.Position = UDim2.new(0, 0, 0, 150)
viewButton.Text = "View"
viewButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)

-- Local variables for tracking state
local targetPlayerName = ""
local targetPlayer = nil
local knocking = false
local spectating = false

-- Function to update target player
local function updateTargetPlayer(name)
    targetPlayer = nil
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player.Name:lower():sub(1, #name) == name:lower() then
            targetPlayer = player
            break
        end
    end
end

-- Function to teleport to the target player
local function teleportToPlayer()
    if targetPlayer then
        local targetChar = targetPlayer.Character
        if targetChar then
            local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
            if targetHRP then
                player.Character:SetPrimaryPartCFrame(targetHRP.CFrame + Vector3.new(0, 5, 0))
            end
        end
    end
end

-- Function to start or stop knocking
local function toggleKnock()
    if not targetPlayer then
        print("No target player to knock.")
        return
    end

    knocking = not knocking
    knockButton.BackgroundColor3 = knocking and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)

    while knocking do
        if targetPlayer then
            local targetChar = targetPlayer.Character
            if targetChar then
                local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                if targetHRP then
                    -- Teleport closer to the player
                    player.Character:SetPrimaryPartCFrame(targetHRP.CFrame - (targetHRP.CFrame.LookVector * 2))

                    -- Fire the event
                    local args = { [1] = "ChargeButton" }
                    game:GetService("ReplicatedStorage"):WaitForChild("MainEvent"):FireServer(unpack(args))
                    
                    wait(1) -- Adjust delay as needed
                end
            end
        end
        wait(0.1) -- Adjust frequency as needed
    end
end

-- Function to start or stop spectating
local function toggleSpectate()
    local targetChar = targetPlayer and targetPlayer.Character
    local targetHRP = targetChar and targetChar:FindFirstChild("HumanoidRootPart")

    if targetHRP then
        if spectating then
            -- Stop spectating
            workspace.CurrentCamera.CameraSubject = player.Character.Humanoid
            workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
            spectating = false
            viewButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        else
            -- Start spectating
            workspace.CurrentCamera.CameraSubject = targetHRP
            workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
            workspace.CurrentCamera.CFrame = targetHRP.CFrame
            spectating = true
            viewButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end
    else
        print("Target player character not found.")
    end
end

-- Connect buttons to functions
teleportButton.MouseButton1Click:Connect(function()
    local name = playerNameInput.Text
    updateTargetPlayer(name)
    teleportToPlayer()
end)

knockButton.MouseButton1Click:Connect(toggleKnock)

viewButton.MouseButton1Click:Connect(toggleSpectate)

print("Script executed successfully.")
